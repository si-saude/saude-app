<head>
<meta charset="utf-8">
</head>

<!-- Preload -->
<app-preload [msg]="msgPreload" [show]="showPreload"></app-preload>

<!-- Confirm Save -->
<app-confirm-save [show]="showConfirmSave" [msg]="msgConfirmSave"
	[goTo]="goTo"></app-confirm-save>

<p style="color: #26a69a; margin-left: 19.7%;"><b>Nome do Empregado: {{riscoPotencial.empregado.pessoa.nome}}</b></p>

<div class="form-container">
	<form #form="ngForm" (ngSubmit)="save()">
		<div class='row'>
			<div class="listClick collection">
					<div *ngFor="let riscoEmpregado of riscoPotencial.riscoEmpregados; let r = index">
					     <div class="row row-collection"  *ngFor="let triagem of riscoEmpregado.triagens; let t = index">
					     	<a (click)="selectTriagem(r,t)" class="collection-item" 
					     	*ngIf="verificarTriagens(triagem)">
					     	{{triagem.equipeAbordagem.abreviacao}} - {{triagem.indicadorSast.nome}}</a>
					     </div>
			     	</div>				
			</div>
			<div class="col s8"*ngIf="triagemAux.id > 0">
				<div class="col s12">
			         <p><b>INDICADOR: {{triagemAux.indicadorSast.nome}}</b></p>
			         <p><b>ÍNDICE: {{getIndiceDescricao(triagemAux)}}</b></p>
			         <p><b>EIXO CLÍNICO: {{triagemAux.diagnostico.eixo.titulo}}</b></p>
			         <p><b>DIAGNÓSTICO: {{triagemAux.diagnostico.descricao}}</b></p>
			         <p><b>INTERVENÇÃO: {{triagemAux.intervencao.descricao}}</b></p>
			         <p><b>EQUIPE DE ABORDAGEM: {{triagemAux.equipeAbordagem.nome}}</b></p>
			         <p><b>SUGESTAO DE PRAZO: {{triagemAux.prazo}}</b></p>
			         <p><b>JUSTIFICATIVA/OBSERVAÇÃO: {{triagemAux.justificativa}}</b></p>
		        </div>
		        <div class="col s12">		        
					<div class="input-field col s8">
						<input type="checkbox"
							name="triagemAux.ignorarAcoes"
							[(ngModel)]="triagemAux.ignorarAcoes"> 
							<label style="color: #26a69a;" for="triagemAux.ignorarAcoes">Ignorar Ações</label>
					</div>
					<div class="input-field col s4">
						<p>
							<a class="btn-floating waves-effect waves-light green btn-add"
								(click)="addAcao()"> <i
								class="material-icons center-icon">add</i>
							  </a>
					        <label style="color: #26a69a;">Adicionar Ação</label>
					    </p>
	   				 </div>
		        </div>
		        <div class="col s12 margemTable">	
		        <div class="row">
					<table class="striped">
						<thead>
							<tr class="row col s12">
								<th class="col s2">Tipo</th>
								<th class="col s2">Status</th>
								<th class="col s2">Tipo de Contato</th>
								<th class="col s3">Datalhe</th>
								<th class="col s1" >Reabrir</th>
								<th class="col s1">Editar</th>
								<th class="col s1">Remover</th>
							</tr>
						</thead>
						<div *ngFor="let acao of triagemAux.acoes; let a = index">
							<tbody class="col s12">
								<tr class="col s12" (click)="reopenAcao(acao)">
									<td class="col s2">{{acao.tipo}}</td>
									<td class="col s2">{{acao.status}}</td>
									<td class="col s2">{{acao.tipoContato}}</td>	
									<td class="col s3">{{textUtil.shortText(acao.acaoIntervencao.descricao)}}</td>
									<td class="col s1">
										<a *ngIf="verifyReopenAcao(acao)" class="waves-effect"
											(click)="reopenAcao(acao)">
										<i class="material-icons center-icon">rotate_right</i></a>											
									</td>
									<td class="col s1">
										<a class="waves-effect"
											(click)="editAcao(a)">
										<i class="material-icons center-icon">mode_edit</i></a>	
									</td>
									<td class="col s1">
										<a class="waves-effect"
											(click)="removeAcao(a)"> 
											<i class="material-icons center-icon">delete</i>
										</a>
									</td>		
								</tr>
							</tbody>
						</div>
					</table>
				</div>
		        
		    </div>    
		                
	      </div>
        </div>
		<div class='row'>
			<div class="col s12">
				<button type="submit" class="btn btn-primary btn-salvar" right>Salvar</button>
			</div>
		</div>
	</form>

	<div class="mensagem">
		<app-mensagem-form *ngIf="verifyError" [color]="colorError"
			[msg]="msgError"></app-mensagem-form>
	</div>
</div>

<!-- Modal Structure -->
<div id="modal" class="modal" materialize="modal"
	[materializeParams]="modelParams" [materializeActions]="modalAcao">

	<div class="row row-modal-acao">

		<div class="row">
			<div class="input-field col s12">
				<fieldset>
					<legend>Tipo de Contato</legend>
					<select name="tipoContato" class="browser-default"
						[(ngModel)]="flagAcao.tipoContato">
						<option disabled selected value="">Selecione um tipo de contato</option>
						<option *ngFor="let tipoContato of tipoContatoAcoes"
							value="{{tipoContato}}">{{tipoContato}}</option>
					</select>
				</fieldset>
			</div>
		</div>

		<div class="row">
			<div class="input-field col s6">
				<fieldset>
					<legend>Tipo</legend>
					<select name="tipo" class="browser-default" [(ngModel)]="flagAcao.tipo">
						<option disabled selected value="">Selecione um tipo</option>
						<option *ngFor="let tipo of tipoAcoes" value="{{tipo}}">{{tipo}}</option>
					</select>
				</fieldset>
		</div>
		<div class="input-field col s12">
			<fieldset>
				<label for="flagAcao.acaoIntervencao" >Ação</label> 						
				<input type="text" materialize="autocomplete" autocomplete="off"
					name="flagAcao.acaoIntervencao.descricao"
					[(ngModel)]="flagAcao.acaoIntervencao.descricao"
					(blur)="autoCompleteAcaoIntervencao.getAutocomplete().getObj($event,flagAcao,'setAcaoIntervencao','getDescricao')"
					(ngModelChange)="autoCompleteAcaoIntervencao.getAutocomplete().getList(flagAcao.acaoIntervencao, 'getDescricao');"
					(keydown.enter)="autoCompleteAcaoIntervencao.getAutocomplete().pressEnter($event,flagAcao,'setAcaoIntervencao','getDescricao');"
					[materializeParams]="autoCompleteAcaoIntervencao.getAutocomplete().getObjAutoComplete()">
			</fieldset>
		</div>	
	</div>

	<div class="modal-footer">
		<a class="waves-effect waves-green btn-flat" (click)="closeModal()">Fechar</a>
		<a class="modal-action modal-close waves-effect waves-green btn-flat"
			(click)="confirmAddAcao()">Confirmar</a>
	</div>

</div>

<div materialize [materializeParams]="toastParams"
	[materializeActions]="globalActions"></div>