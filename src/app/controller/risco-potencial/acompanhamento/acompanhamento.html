<head>
<meta charset="utf-8">
</head>

<!-- Preload -->
<app-preload [msg]="msgPreload" [show]="showPreload"></app-preload>

<!-- Confirm Save -->
<app-confirm-save [show]="showConfirmSave" [msg]="msgConfirmSave"
	[goTo]="goTo"></app-confirm-save>

<div class="form-container">
	<form #form="ngForm" class="col s12" (ngSubmit)="save()">

		<div class="container-triagem">
			<div class="table-triagem">
				<table style="width: 100%">
					<div class="container-triagens-acolhimento">
						<div
							*ngFor="let equipe of equipesAbordagemTriagens; let e = index">
							<p style="margin-left: 20px;">
								<b>{{equipe.nome}}</b>
							</p>
							<div
								*ngFor="let triagem of triagensByEquipeAbordagem[equipe.id]; let t = index">
								<fieldset class="fieldset-planejamento-triagem">
									<tr class="row col s12">
										<td class="col s3 label-indicador-acolhimento">Indicador</td>
										<td class="col s9 indicador-acolhimento">{{triagem.indicadorSast.nome}}</td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-indice-descricao-acolhimento">Índice
											Descrição</td>
										<td class="col s9 indice-descricao-acolhimento">{{getIndiceDescricao(triagem)}}</td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-eixo-clinico-acolhimento">Eixo
											Clínico</td>
										<td class="col s9 eixo-clinico-acolhimento"><input
											type="text" name="eixo-clinico-acolhimento{{e}}{{t}}"
											disabled [(ngModel)]="triagem.diagnostico.eixo.titulo"></td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-diagnostico-acolhimento">Diagnóstico</td>
										<td class="col s9 diagnostico-acolhimento"><input
											type="text" name="diagnostico-acolhimento{{e}}{{t}}" disabled
											[(ngModel)]="triagem.diagnostico.descricao"></td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-intervencao-acolhimento">Intervenção</td>
										<td class="col s9 intervencao-acolhimento"><input
											type="text" name="intervencao-acolhimento{{e}}{{t}}" disabled
											[(ngModel)]="triagem.intervencao.descricao"></td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-equipe-abordagem-acolhimento">Equipe
											de Abordagem</td>
										<td class="col s9 equipe-abordagem-acolhimento"><input
											type="text" name="equipe-abordagem-acolhimento{{e}}{{t}}"
											disabled [(ngModel)]="triagem.equipeAbordagem.nome">
										</td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-prazo-inicio-acolhimento">Sugestão
											de prazo de início</td>
										<td class="col s9 prazo-inicio-acolhimento"><input
											type="text" name="prazo-inicio-acolhimento{{e}}{{t}}"
											disabled [(ngModel)]="triagem.prazo"></td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-justificativa-acolhimento">Justificativa/Observação</td>
										<td class="col s9 justificativa-acolhimento"><input
											type="text" name="justificativa-acolhimento{{e}}{{t}}"
											disabled [(ngModel)]="triagem.justificativa"></td>
									</tr>
									<tr class="row col s12">
										<td class="col s3 label-acoes">Acões</td>
										<td class="col s9">
											<div *ngFor="let acao of triagem.acoes; let a = index">
												<fieldset>
													<legend>Ação</legend>
													<div class="row">
														<div class="col s6">
															<label for="tipo{{a}}">Tipo</label> <input type="text"
																disabled name="tipo{{a}}" value={{acao.tipo}}>
														</div>
														<div class="col s6">
															<label for="status{{a}}">Status</label> <input
																type="text" disabled name="status{{a}}"
																value={{acao.status}}>
														</div>
													</div>
													<div class="row">
														<div class="col s6">
															<label for="tipoContato">Tipo de Contato</label> <input
																type="text" disabled name="tipoContato{{a}}"
																value={{acao.tipoContato}}>
														</div>
														<div class="col s6">
															<label for="dataAcao">Data</label>
															<p>{{dataAcoes[triagem.id][a].formatted}}</p>
															<!-- <my-date-picker name="dataAcoes{{a}}" disabled 
															[options]="myDatePickerOptions" placeholder="Data"
															[(ngModel)]="dataAcoes[triagem.id][a]"> </my-date-picker>
															 -->
														</div>
													</div>
													<div class="row">
														<div class="col s12">
															<label for="detalhe">Detalhe</label>
															<textarea class="materialize-textarea" disabled
																name="detalhe{{a}}" value={{acao.detalhe}}></textarea>
														</div>
													</div>

													<div class="row">
														<fieldset>
															<legend>Acompanhamentos
																<a (click)="addAcompanhamento(equipe.id,triagem.id,a)" 
																	*ngIf="verifyAcompanhamento(equipe.id, triagem.id, a)"
																	class="btn-floating waves-effect waves-light btn-add-acompanhamento">
																		<i class="material-icons center-icon">add</i>
																</a>
															</legend>
															<table class="striped table-acompanhamento">
																<thead>
																	<tr class="row col s12">
																		<th class="col s9">Descrição</th>
																		<th class="col s3">Remover</th>
																	</tr>
																</thead>
																<div
																	*ngFor="let acompanhamento of acao.acompanhamentos; let acmp = index">
																	<tbody class="col s12">
																		<tr class="col s12">
																			<td class="col s9 descricao">
																				<textarea class="materialize-textarea acompanhamento-descricao" 
																					[(ngModel)]="acompanhamento.descricao"
																					name="acompanhamento{{acmp}}.descricao">
																				</textarea>
																			</td>
																			<td class="col s3 botao-remover"><a
																				*ngIf="verifyAcompanhamento(equipe.id, triagem.id, a)"
																				class="btn-floating waves-effect waves-light red btn-remove"
																				(click)="removeAcompanhamento(equipe.id,triagem.id,a,acmp)"> <i
																					class="material-icons i-remove-acompanhamento">delete</i>
																			</a></td>
																		</tr>
																	</tbody>
																</div>
															</table>
														</fieldset>
													</div>
													
													<div class="row center">
														<a (click)="encerrarAcao(equipe.id, triagem.id, a)" class="btn btn-primary btn-encerrar">Encerrar</a>
													</div>
												</fieldset>

											</div>
										</td>
									</tr>
								</fieldset>
							</div>
						</div>

					</div>
				</table>
			</div>

			<input id="id" name="id" type="hidden"
				[(ngModel)]="riscoPotencial.id"> <input id="version"
				name="version" type="hidden" [(ngModel)]="riscoPotencial.version">

		</div>

		<div class='row row-btns'>
			<div class="col s4">
				<a [routerLink]="['/risco-potencial']"
					class="btn btn-primary btn-voltar">Voltar</a>
			</div>
			<div class="col s4 center">
				<a (click)="validar()" class="btn btn-primary btn-validar">Validar</a>
			</div>
			<div class="col s4">
				<button type="submit" class="btn btn-primary btn-salvar">Salvar</button>
			</div>
		</div>
	</form>

	<div class="mensagem">
		<app-mensagem-form *ngIf="verifyError" [color]="colorError"
			[msg]="msgError"></app-mensagem-form>
	</div>
</div>

<!-- Modal Structure -->
<div id="modal" class="modal" materialize="modal"
	[materializeParams]="modelParams" [materializeActions]="modalAcao">

	<div class="row row-modal-acao">

		<div class="row">
			<div class="input-field col s12">
				<fieldset>
					<legend>Tipo de Contato</legend>
					<select name="tipoContato" class="browser-default"
						[(ngModel)]="acao.tipoContato">
						<option disabled selected value="">Selecione um tipo de contato</option>
						<option *ngFor="let tipoContato of tipoContatoAcoes"
							value="{{tipoContato}}">{{tipoContato}}</option>
					</select>
				</fieldset>
			</div>
		</div>

		<div class="row">
			<div class="input-field col s6">
				<fieldset>
					<legend>Tipo</legend>
					<select name="tipo" class="browser-default" [(ngModel)]="acao.tipo">
						<option disabled selected value="">Selecione um tipo</option>
						<option *ngFor="let tipo of tipoAcoes" value="{{tipo}}">{{tipo}}</option>
					</select>
				</fieldset>
			</div>

			<div class="input-field col s6">
				<label for="dataTarefaAcao">Data</label>
				<my-date-picker name="dataTarefaAcao"
					[options]="myDatePickerOptions" [(ngModel)]="dataTarefaAcao"
					placeholder="Data"> </my-date-picker>
			</div>
		</div>

		<div class="input-field col s12">
			<label for="acao.detalhe">Detalhe</label>
			<textarea class="materialize-textarea" [(ngModel)]="acao.detalhe"
				name="acao.detalhe"></textarea>
		</div>

	</div>

	<div class="modal-footer">
		<a class="waves-effect waves-green btn-flat" (click)="closeModal()">Fechar</a>
		<a class="modal-action modal-close waves-effect waves-green btn-flat"
			(click)="confirmAddAcao()">Confirmar</a>
	</div>

</div>

<div materialize [materializeParams]="toastParams"
	[materializeActions]="globalActions"></div>