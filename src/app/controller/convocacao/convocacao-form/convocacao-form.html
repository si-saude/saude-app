<head>
<meta charset="utf-8">
</head>

<!-- Preload  -->
<app-preload [msg]="msgPreload" [show]="showPreload"></app-preload>

<!-- Confirm Save -->
<app-confirm-save [show]="showConfirmSave" [msg]="msgConfirmSave"
	[goTo]="goTo"></app-confirm-save>

<form #form="ngForm" class="col s12 form-convocacao" (ngSubmit)="save()">

	<div class="row">
		<div class="col s12">
			<ul class="tabs" materialize="tabs">
				<li class="tab col s4"><a RouterLinkActive="active"
					href="#dadosGerais">Dados Gerais</a></li>
				<li class="tab col s4" [ngClass]="selectProfissiogramaTab()"><a
					RouterLinkActive="active" href="#cronogramaGerencias">Cronograma
						das Gerências</a></li>
				<li class="tab col s4" [ngClass]="selectProfissiogramaTab()"><a
					RouterLinkActive="active" href="#empregados">Empregados</a></li>
			</ul>
		</div>

		<div id="dadosGerais">

			<div class="row">
				<div class="input-field col s12">
					<label data-error="Campo obrigatório." for="titulo">Titulo</label>
					<input id="nome" type="text" required maxlength="400"
						[(ngModel)]="convocacao.titulo" name="titulo">
				</div>
			</div>

			<div class="row">

				<div class="input-field col s6">
					<fieldset>
						<legend>Tipo</legend>
						<select name="convocacao.tipo" class="browser-default"
							[(ngModel)]="convocacao.tipo">
							<option disabled selected value="">Selecione um tipo</option>
							<option *ngFor="let tipo of tipos" value="{{tipo}}">{{tipo}}</option>
						</select>
					</fieldset>
				</div>

				<div class="input-field col s6" *ngIf="!existProfissiograma">
					<fieldset>
						<legend>Profissiograma</legend>
						<select name="profissiograma" class="browser-default"
							[(ngModel)]="convocacao.profissiograma.id"
							(ngModelChange)="openModalConfirmProfissiograma()">
							<option disabled selected value=0>Selecione um profissiograma</option>
							<option *ngFor="let profissiograma of profissiogramas"
								value="{{profissiograma.id}}">{{profissiograma.nome}}</option>
						</select>
					</fieldset>
				</div>

				<div class="input-field col s6" *ngIf="existProfissiograma">
					<fieldset>
						<legend>Profissiograma</legend>
						<select disabled name="profissiograma" class="browser-default"
							[(ngModel)]="convocacao.profissiograma.id">
							<option disabled selected value=0>Selecione um profissiograma</option>
							<option *ngFor="let profissiograma of profissiogramas"
								value="{{profissiograma.id}}">{{profissiograma.nome}}</option>
						</select>
					</fieldset>
				</div>

			</div>

		</div>

		<div id="cronogramaGerencias">

			<div class="row">
				<div class="input-field col s12">
					<label for="filtroGerenciaConvocacoes">Filtrar Gerências</label> <input
						id="filtroGerenciaConvocacoes" type="text"
						name="filtroGerenciaConvocacoes"
						(ngModelChange)="filterGerenciaConvocacoes($event)"
						[(ngModel)]="filterGerenciaByCodigoCompleto">
				</div>
			</div>

			<div class="row col s12">

				<div class="collection gerencias col s7">
					<div class="row-item-collection"
						*ngFor="let gerenciaConvocacao of gerenciaConvocacoes; let gC = index">
						<div class="input-field">
							<div class="row row-collection">
								<div class="col s7">
									<a class="collection-item"
										(click)="choiseGerenciaConvocacao(gC, gerenciaConvocacao)"
										[ngClass]="choisedGerenciaConvocacao(gC, gerenciaConvocacao)"
										[routerLinkActive]="['active']"
										[ngStyle]="{'cursor': 'pointer'}">
										{{gerenciaConvocacao.gerencia.codigoCompleto}} </a>
								</div>
								<div class="input-field col s1 checkbox">
									<input type="checkbox"
										id="gerenciaConvocacao.selecionado[{{gC}}]"
										[(ngModel)]="gerenciaConvocacao.selecionado"
										(click)="selectGerenciaConvocacao(gC, gerenciaConvocacao)"
										name="gerenciaConvocacao.selecionado[{{gC}}]"> <label
										for="gerenciaConvocacao.selecionado[{{gC}}]"></label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col s5 datas">
					<div class="row-item-collection"
						*ngFor="let selectedGerencia of selectedGerenciaConvocacaoCC; let gC = index">
						<div class="row-item-collection">
							<div>
								<p>{{selectedGerencia}}</p>
							</div>
							<div class="gerenciaConvocacaoDatas">
								<div class="row">
									<div class="input-field col s8">
										<label for="dataGerenciaConvocacaoInicio[{{gC}}]">Início</label>
										<my-date-picker name="dataGerenciaConvocacaoInicio[{{gC}}]"
											[options]="myDatePickerOptions"
											[(ngModel)]="dataGerenciaConvocacaoInicio[selectedGerencia]"
											placeholder="Início"> </my-date-picker>
									</div>
									<div class="input-field col s8">
										<label for="dataGerenciaConvocacaoFim[{{gC}}]">Fim</label>
										<my-date-picker name="dataGerenciaConvocacaoFim[{{gC}}]"
											[options]="myDatePickerOptions"
											[(ngModel)]="dataGerenciaConvocacaoFim[selectedGerencia]"
											placeholder="Fim"> </my-date-picker>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>


			</div>

		</div>

		<div id="empregados">

			<div class="row">
				<div class="input-field col s10">
					<label for="empregado">Empregado</label> <input type="text"
						materialize="autocomplete" name="addEmpregado"
						(blur)="getEmpregado($event)"
						[(ngModel)]="empregadoToAdd.pessoa.nome"
						(ngModelChange)="selectEmpregadoByChave($event);selectEmpregado($event);"
						[materializeParams]="autocompleteEmpregado">
				</div>
				<div class="input-field col s2" style="margin-top: 30px;">
					<a
						class="btn-floating waves-effect waves-light green btn-add-autocomplete"
						(click)="addEmpregado()"> <i
						class="material-icons center-icon">add</i>
					</a>
				</div>
			</div>
			<div class="row">
				<div class="input-field col s2">
					<label for="filterEmpregadoByChave">Chave</label> <input
						id="filterEmpregadoByChave" type="text"
						name="filterEmpregadoByChave" [(ngModel)]="filterChaveEmpregado"
						(ngModelChange)="filterEmpregadoByChave($event)">
				</div>
				<div class="input-field col s5">
					<label for="filterEmpregadoByNome">Nome</label> <input
						id="filterEmpregadoByNome" type="text"
						name="filterEmpregadoByNome" [(ngModel)]="filterNomeEmpregado"
						(ngModelChange)="filterEmpregadoByNome($event)">
				</div>
				<div class="input-field col s5">
					<label for="filterEmpregadoByGerencia">Gerência</label> <input
						id="filterEmpregadoByGerencia" type="text"
						name="filterEmpregadoByGerencia"
						[(ngModel)]="filterGerenciaEmpregado"
						(ngModelChange)="filterEmpregadoByGerencia($event)">
				</div>
			</div>

			<div class="row">
				<div class="input-field col s12 checkbox">
					<input type="checkbox" id="checkEmpregados"
						[(ngModel)]="checkEmpregados" (click)="checkAllEmpregados()"
						name="checkEmpregados"> <label for="checkEmpregados">Selecionar/Desselecionar
						Todos</label>
				</div>
			</div>

			<div class="row">

				<table class="striped">
					<thead>
						<tr class="row col s12">
							<th class="col s1">Chave</th>
							<th class="col s4">Nome</th>
							<th class="col s3">Gerência</th>
							<th class="col s1">Selecionar</th>
							<th class="col s1">Convocado</th>
							<th class="col s1">Editar</th>
							<th class="col s1">Excluir</th>
						</tr>
					</thead>
					<div
						*ngFor="let empregadoConvocacao of empregadoConvocacoes; let eC = index">
						<tbody class="col s12">
							<tr class="col s12">
								<td class="col s1 chave">{{empregadoConvocacao.empregado.chave}}</td>
								<td class="col s4 nome">{{empregadoConvocacao.empregado.pessoa.nome}}</td>
								<td class="col s3 codigo_completo">{{empregadoConvocacao.empregado.gerencia.codigoCompleto}}</td>		
								<td class="col s1 checkbox_selecionado" 
									*ngIf="empregadoConvocacao.auditado">
									<input type="checkbox"
										id="empregadoConvocacao[{{eC}}].selecionado"
										[(ngModel)]="empregadoConvocacao.selecionado"
										name="empregadoConvocacao[{{eC}}].selecionado"> <label
										for="empregadoConvocacao[{{eC}}].selecionado"></label>
								</td>
								<td class="col s1 checkbox_selecionado"
									*ngIf="!empregadoConvocacao.auditado">
									<input type="checkbox" disabled
										id="empregadoConvocacao[{{eC}}].selecionado"
										[(ngModel)]="empregadoConvocacao.selecionado"
										name="empregadoConvocacao[{{eC}}].selecionado"> <label
										for="empregadoConvocacao[{{eC}}].selecionado"></label>
								</td>
								<td class="col s1 checkbox_convocado">
									<input disabled type="checkbox"
										id="empregadoConvocacao[{{eC}}].convocado"
										[(ngModel)]="empregadoConvocacao.convocado"
										name="empregadoConvocacao[{{eC}}].convocado"> <label
										for="empregadoConvocacao[{{eC}}].convocado"></label>
								</td>
								<td class="col s1 btn_edit">
									<a (click)="showDetailEmpregado(eC)"
										[ngStyle]="{'cursor': 'pointer'}"><i
										class="material-icons">mode_edit</i></a>
								</td>
								<td class="col s1 btn_remove">
									<a (click)="removeEmpregadoToList(eC)"
										[ngStyle]="{'cursor': 'pointer'}"><i
										class="material-icons">delete</i></a>
								</td>
							</tr>
						</tbody>
					</div>

				</table>
			</div>
			<div class="row btn-convocar" *ngIf="ableToConvocate()">
				<div class="col s4">
					<a (click)="convocar()" class="btn btn-primary">Convocar</a>
				</div>
			</div>

		</div>

	</div>

	<input id="id" name="id" type="hidden"> <input id="version"
		name="version" type="hidden">

	<div class="mensagem">
		<app-mensagem-form *ngIf="verifyError" [color]="colorError"
			[msg]="msgError"></app-mensagem-form>
	</div>

	<div class='row row-btns'>
		<div class="col s6">
			<a [routerLink]="['/convocacao']"
				class="btn btn-primary btn-listar">Listar</a>
		</div>
		<div class="col s6">
			<button type="submit" class="btn btn-primary btn-salvar">Salvar</button>
		</div>
	</div>

</form>

<!-- Modal Structure -->
<div id="modal" class="modal" materialize="modal"
	[materializeParams]="modalParams"
	[materializeActions]="modalEditEmpregado">

	<h5 class="titleModal">Exames - Empregado</h5>

	<div class="row">
		<div class="input-field col s6">
			<fieldset>
				<legend>Exames</legend>
				<select name="exames" class="browser-default" #exame>
					<option disabled selected value=0>Selecione um exame</option>
					<option *ngFor="let exame of exames" value="{{exame.id}}">{{exame.codigo}} - {{exame.descricao}}</option>
				</select>
			</fieldset>
		</div>
		<div class="input-field col s2">
			<a
				class="btn-floating waves-effect waves-light green btn-add"
				(click)="addExame(exame.value)"> <i
				class="material-icons center-icon">add</i>
			</a>
		</div>
		<div class="input-field col s4 checkbox" *ngIf="!verifyAuditado()">
			<input type="checkbox" id="auditado" disabled
				[(ngModel)]="empregadoDetail.auditado"
				name="empregadoDetail.auditado"> <label for="auditado">Auditado</label>
		</div>
		<div class="input-field col s4 checkbox" *ngIf="verifyAuditado()">
			<input type="checkbox" id="auditado"
				[(ngModel)]="empregadoDetail.auditado"
				name="empregadoDetail.auditado"> <label for="auditado">Auditado</label>
		</div>
	</div>

	<div class="collection">

		<div class="row"
			*ngFor="let empregadoConvocacaoExame of empregadoDetail.empregadoConvocacaoExames; let e = index">
			<div class="row row-collection">
				<div class="col s4">
					<a class="collection-item">
						{{empregadoConvocacaoExame.exame.codigo}} </a>
				</div>
				<div class="col s4">
					<a class="collection-item">
						{{empregadoConvocacaoExame.exame.descricao}} </a>
				</div>
				<div class="col s2"
					*ngIf="!empregadoConvocacaoExame.pendenteRelatorio">
					<input type="checkbox" (click)="selectConform(e)"
						id="empregadoConvocacaoExame[{{e}}].conforme"
						[(ngModel)]="empregadoConvocacaoExame.conforme"
						name="empregadoConvocacaoExame[{{e}}].conforme"> <label
						for="empregadoConvocacaoExame[{{e}}].conforme">Conforme</label>
				</div>
				<div class="col s2">
					<a (click)="removeExame(e)" [ngStyle]="{'cursor': 'pointer'}">
						<i class="material-icons">delete</i>
					</a>
				</div>
			</div>
		</div>

	</div>

	<div class="modal-footer">
		<a class="waves-effect waves-green btn-flat"
			(click)="closeModalEditEmpregado()">Fechar</a>
	</div>

</div>

<!-- Modal Structure -->
<div id="modal" class="modal" materialize="modal"
	[materializeParams]="modalParams"
	[materializeActions]="modalConfirmProfissiograma">

	<h5 class="titleModal">Confirmação</h5>

	<p class="paragraphModal">Tem certeza que deseja selecionar este
		profissiograma?</p>
	<p class="paragraphModal">Se sim, ele não poderá ser alterado.</p>

	<div class="modal-footer">
		<a class="waves-effect waves-green btn-flat"
			(click)="confirmarProfissiograma()">Confirmar</a> <a
			class="waves-effect waves-green btn-flat"
			(click)="cancelarProfissiograma()">Cancelar</a>
	</div>

</div>

<div materialize [materializeParams]="toastParams"
	[materializeActions]="globalActions"></div>